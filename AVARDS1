from flask import Flask, request, jsonify
import random

app = Flask(__name__)

LET_POOL = 0
PLAYERS = {}

@app.route("/join", methods=["POST"])
def join():
    user_id = request.json["user_id"]
    if user_id not in PLAYERS:
        PLAYERS[user_id] = random.randint(1, 30)
    return jsonify({
        "status": "joined",
        "your_number": PLAYERS[user_id]
    })

@app.route("/click", methods=["POST"])
def click():
    global LET_POOL
    user_id = request.json["user_id"]
    button = request.json["button"]

    # –ö–∞–∂–¥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –¥–∞—ë—Ç 5 LET
    LET_POOL += 5

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–≥–∞–¥–∞–ª –ª–∏ –∏–≥—Ä–æ–∫ —Å–≤–æ—ë —á–∏—Å–ª–æ
    if PLAYERS.get(user_id) == button:
        win = LET_POOL
        LET_POOL = 0
        return jsonify({
            "win": True,
            "energy": win,
            "message": f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É–≥–∞–¥–∞–ª–∏ —á–∏—Å–ª–æ {button} –∏ –∑–∞–±–∏—Ä–∞–µ—Ç–µ –≤–µ—Å—å –ø—É–ª LET!"
        })

    return jsonify({
        "win": False,
        "pool": LET_POOL,
        "message": f"–í—ã –Ω–∞–∂–∞–ª–∏ –∫–Ω–æ–ø–∫—É {button}. –í –ø—É–ª –¥–æ–±–∞–≤–ª–µ–Ω–æ +5 LET"
    })

@app.route("/pool")
def pool():
    return jsonify({
        "LET_pool": LET_POOL
    })
