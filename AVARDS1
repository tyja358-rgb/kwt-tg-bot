// ======== –ö–Ω–æ–ø–∫–∞ —à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∏ –∏ –ø–∞–Ω–µ–ª—å ========
const gearBtn = document.createElement('button');
gearBtn.innerHTML = '‚öôÔ∏è';
gearBtn.style.position = 'fixed';
gearBtn.style.top = '10px';
gearBtn.style.right = '10px';
gearBtn.style.zIndex = 40001;
gearBtn.style.padding = '6px';
gearBtn.style.background = '#ff0';
gearBtn.style.color = '#000';
gearBtn.style.border = '1px solid #000';
gearBtn.style.borderRadius = '4px';
gearBtn.style.cursor = 'pointer';
gearBtn.style.display = 'none'; // üîπ –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
document.body.appendChild(gearBtn);

// –ü–∞–Ω–µ–ª—å –∫–Ω–æ–ø–æ–∫ –≤–Ω—É—Ç—Ä–∏ —à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∏
const gearPanel = document.createElement('div');
gearPanel.style.position = 'fixed';
gearPanel.style.top = '40px';
gearPanel.style.right = '10px';
gearPanel.style.width = '120px';
gearPanel.style.background = '#1b002b';
gearPanel.style.color = '#fff';
gearPanel.style.padding = '5px';
gearPanel.style.border = '2px solid gold';
gearPanel.style.borderRadius = '6px';
gearPanel.style.display = 'none';
gearPanel.style.zIndex = 40000;
document.body.appendChild(gearPanel);

// –ö–Ω–æ–ø–∫–∞ –ß–≠–°
const chesBtn = document.createElement('button');
chesBtn.textContent = '–ß–≠–°';
chesBtn.style.width = '100%';
chesBtn.style.margin = '3px 0';
chesBtn.style.padding = '6px';
chesBtn.style.cursor = 'pointer';
gearPanel.appendChild(chesBtn);

// –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ß–≠–°
const adminPanel = document.createElement('div');
adminPanel.style.position = 'fixed';
adminPanel.style.top = '40px';
adminPanel.style.right = '140px';
adminPanel.style.width = '300px';
adminPanel.style.maxHeight = '70vh';
adminPanel.style.overflowY = 'auto';
adminPanel.style.background = '#1b002b';
adminPanel.style.color = '#fff';
adminPanel.style.padding = '10px';
adminPanel.style.border = '2px solid gold';
adminPanel.style.borderRadius = '8px';
adminPanel.style.display = 'none';
adminPanel.style.zIndex = 40000;
document.body.appendChild(adminPanel);

// üîπ –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ —à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∏
gearBtn.onclick = () => {
    gearPanel.style.display = gearPanel.style.display === 'none' ? 'block' : 'none';
};

// üîπ –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –ß–≠–°
chesBtn.onclick = () => {
    renderAdminPanel();
    adminPanel.style.display = adminPanel.style.display === 'none' ? 'block' : 'none';
};

// ===== –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∞ –ø–∞–Ω–µ–ª–∏ –ß–≠–° =====
function renderAdminPanel(){
    adminPanel.innerHTML = '<h3>–ß–∞—Å—Ç–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏</h3>';
    const chesList = document.createElement('ul');
    chesList.style.paddingLeft = '15px';

    for(const id in stationsData){
        const st = stationsData[id];
        const li = document.createElement('li');
        li.style.marginBottom = '6px';
        li.innerHTML = `
            –°—Ç–∞–Ω—Ü–∏—è ${id} ‚Äî –í–ª–∞–¥–µ–ª–µ—Ü: ${st.owner} ‚Äî –ú–æ—â–Ω–æ—Å—Ç—å: ${st.power.toFixed(1)}
            <button style="margin-left:5px;">–£–¥–∞–ª–∏—Ç—å</button>
            <button style="margin-left:5px;">–ò–∑–º–µ–Ω–∏—Ç—å –º–æ—â–Ω–æ—Å—Ç—å</button>
        `;
        const buttons = li.querySelectorAll('button');
        buttons[0].onclick = () => removeStation(id);
        buttons[1].onclick = () => changeStationPower(id);
        chesList.appendChild(li);
    }

    adminPanel.appendChild(chesList);
}

// ===== –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞–Ω—Ü–∏—è–º–∏ =====
function removeStation(id){
    if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç–∞–Ω—Ü–∏—é?')){
        if(stationMarkers[id]) map.removeLayer(stationMarkers[id]);
        delete stationsData[id];
        delete stationMarkers[id];
        renderAdminPanel();
    }
}

function changeStationPower(id){
    const newPower = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –º–æ—â–Ω–æ—Å—Ç—å:', stationsData[id].power.toFixed(1));
    if(newPower !== null){
        stationsData[id].power = parseFloat(newPower);
        if(stationMarkers[id]){
            stationMarkers[id].bindPopup(
                `<b>–°—Ç–∞–Ω—Ü–∏—è</b><br>–í–ª–∞–¥–µ–ª–µ—Ü:${stationsData[id].owner}<br>–≠–Ω–µ—Ä–≥–∏—è:${stationsData[id].power.toFixed(1)}<br>` +
                (stationsData[id].owner==playerId ? `<button onclick="collectStation(${id})">–°–æ–±—Ä–∞—Ç—å</button>` : '<i>–ß—É–∂–∞—è —Å—Ç–∞–Ω—Ü–∏—è</i>')
            );
        }
        renderAdminPanel();
    }
}

// ===== –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–æ–∑—è–∏–Ω–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è playerId =====
function checkOwnerAndShowGear(){
    const MY_ID = 123456789; // üîπ –¢–≤–æ–π Telegram ID
    if(playerId === MY_ID){
        gearBtn.style.display = 'block';
    } else {
        gearBtn.style.display = 'none';
    }
}

// üîπ –í—ã–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ playerId –∏–∑–≤–µ—Å—Ç–µ–Ω
if(playerId) checkOwnerAndShowGear();
