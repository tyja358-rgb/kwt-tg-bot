from telegram import Update
from telegram.ext import Updater, CommandHandler, CallbackContext
import requests

TOKEN = "8389490742:AAGXDGWxGCdREk4peI3I8fPU1cGMBpdaHvM"
API_URL = "https://Moldova2026.pythonanywhere.com"

def start(update: Update, context: CallbackContext):
    user_id = update.effective_user.id

    requests.post(f"{API_URL}/join", json={
        "user_id": user_id
    })

    update.message.reply_text(
        "‚ö° –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ LET Energy\n"
        "–¢—ã –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –æ–±—â–µ–π —ç–Ω–µ—Ä–≥–æ—Å–µ—Ç–∏.\n\n"
        "–ö–æ–º–∞–Ω–¥—ã:\n"
        "/pool ‚Äî –æ–±—â–∏–π –ø—É–ª —ç–Ω–µ—Ä–≥–∏–∏\n"
        "/play ‚Äî –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É"
    )

def pool(update: Update, context: CallbackContext):
    r = requests.get(f"{API_URL}/pool").json()
    update.message.reply_text(
        f"üîã –û–±—â–∏–π –ø—É–ª —ç–Ω–µ—Ä–≥–∏–∏: {r['LET_pool']} LET"
    )

def play(update: Update, context: CallbackContext):
    update.message.reply_text(
        "üéÆ –ò–≥—Ä–∞ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞.\n"
        "–°–µ–π—á–∞—Å –º—ã –ø–æ–¥–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏."
    )

def main():
    updater = Updater(TOKEN)
    dp = updater.dispatcher

    dp.add_handler(CommandHandler("start", start))
    dp.add_handler(CommandHandler("pool", pool))
    dp.add_handler(CommandHandler("play", play))

    updater.start_polling()
    updater.idle()

if __name__ == "__main__":
    main()
