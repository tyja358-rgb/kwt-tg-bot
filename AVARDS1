from flask import Flask, request, jsonify, send_from_directory
import os

app = Flask(__name__)
UPLOAD_FOLDER = 'static/uploads'
os.makedirs(UPLOAD_FOLDER, exist_ok=True)

photos = []  # список загруженных фото

@app.route('/')
def index():
    return "Hello from Flask! Теперь с загрузкой фото!"

@app.route('/upload', methods=['POST'])
def upload():
    file = request.files.get('photo')
    category = request.form.get('category', '')
    username = request.form.get('username', 'Аноним')
    if not file:
        return jsonify({'status':'error','message':'Нет файла'})
    filename = file.filename
    file.save(os.path.join(UPLOAD_FOLDER, filename))
    photo_id = len(photos) + 1
    photos.append({'id': photo_id, 'filename': filename, 'category': category, 'username': username})
    return jsonify({'status':'ok','photo_id':photo_id})

@app.route('/photos')
def get_photos():
    return jsonify(photos)

@app.route('/static/uploads/<filename>')
def uploaded_file(filename):
    return send_from_directory(UPLOAD_FOLDER, filename)

if __name__ == '__main__':
    app.run()
