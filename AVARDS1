let mapReady = false;

function initMap() {
    if (map) return;
    map = L.map('map', { zoomControl: true }).setView([playerLat, playerLng], 15);
    userMarker = L.marker([playerLat, playerLng]).addTo(map).bindPopup("Вы здесь");

    mapReady = true;
    generatePoints();
    loadStations();
}

// и в интервал движения
setInterval(()=>{
    if(!mapReady) return; // ждём, пока карта и маркер созданы
    ...
},50);
